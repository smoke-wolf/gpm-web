<!DOCTYPE html>
<html>
<head>
  <title>GitHub Repository Search</title>
  <link rel="stylesheet" type="text/css" href="web.css">
  <style>
    /* Add your custom styles here to make it smoother and more interactive */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    /* ... */

    #repositoryList {
      list-style: none;
      padding: 0;
    }

    .repository {
      padding: 10px;
      border-bottom: 1px solid #ccc;
      cursor: pointer;
    }

    .repository:hover {
      background-color: #f5f5f5;
    }

    .repository-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .arrow-icon {
      width: 10px;
      height: 10px;
      background-color: black;
      transform: rotate(45deg);
      transition: transform 0.3s;
    }

    .expanded .arrow-icon {
      transform: rotate(-135deg);
    }

    .readme-content {
      display: none;
      margin-top: 10px;
      padding: 10px;
      border: 1px solid #ccc;
    }

    .expanded .readme-content {
      display: block;
    }
  </style>
</head>
<body>
  <div id="container">
    <button id="profileButton">Profile</button>
    <button id="adminButton">Admin</button>
    <h1>GitHub Repository Search</h1>

    <div id="searchContainer">
      <input type="text" id="searchInput" placeholder="Search repositories">
      <select id="filterInput">
        <option value="none">No Filter</option>
        <option value="user">User</option>
        <option value="recent">Recent</option>
        <option value="stars">Stars</option>
        <option value="downloads">Downloads</option>
      </select>
      <button id="searchButton">Search</button>
    </div>

    <div id="results">
      <ul id="repositoryList"></ul>
    </div>

    <div id="profile" style="display: none;">
      <h2>Profile Settings</h2>
      <label for="profileInput">Profile URL:</label>
      <input type="text" id="profileInput" placeholder="Enter profile URL">
      <button id="saveButton">Save</button>
    </div>

    <div id="admin" style="display: none;">
      <h2>Admin Dashboard</h2>
      <label for="adminInput">Enter Password:</label>
      <input type="password" id="adminInput" placeholder="Password">
      <button id="adminSaveButton">Log In</button>
      <div id="dashboard" style="display: none;">
        <div class="dashboard-item">
          <label>Total Site Visits:</label>
          <span id="siteVisits"></span>
        </div>
        <div class="dashboard-item">
          <label>Viewed Repositories:</label>
          <ul id="viewedRepos" class="dashboard-list"></ul>
        </div>
        <div class="dashboard-item">
          <label>Connected IPs:</label>
          <ul id="connectedIPs" class="dashboard-list"></ul>
        </div>
      </div>
    </div>
  </div>

  <script src="web.js"></script>
  <script>
    var siteVisitsCount = parseInt(localStorage.getItem("siteVisitsCount")) || 0;
    var viewedRepos = [];
    var connectedIPs = [];

    function updateSiteVisitsCount() {
      siteVisitsCount++;
      document.getElementById("siteVisits").textContent = siteVisitsCount;
      localStorage.setItem("siteVisitsCount", siteVisitsCount);
    }

    function updateViewedRepos(repository) {
      viewedRepos.push(repository);
      var viewedReposList = document.getElementById("viewedRepos");
      var listItem = document.createElement("li");
      listItem.textContent = repository;
      viewedReposList.appendChild(listItem);
    }

    function updateConnectedIPs(ip) {
      connectedIPs.push(ip);
      var connectedIPsList = document.getElementById("connectedIPs");
      var listItem = document.createElement("li");
      listItem.textContent = ip;
      connectedIPsList.appendChild(listItem);
    }

    function displayAdminDashboard() {
      document.getElementById("adminInput").value = "";
      document.getElementById("admin").style.display = "none";
      document.getElementById("dashboard").style.display = "block";
    }

    function checkAdminPassword() {
      var password = document.getElementById("adminInput").value;
      if (password === "admin_user") {
        displayAdminDashboard();
      } else {
        alert("Invalid password. Please try again.");
      }
    }

    document.getElementById("adminButton").addEventListener("click", function() {
      document.getElementById("admin").style.display = "block";
    });

    document.getElementById("adminSaveButton").addEventListener("click", function() {
      checkAdminPassword();
    });

    document.getElementById("searchButton").addEventListener("click", function() {
      var searchInput = document.getElementById("searchInput").value;
      var filterInput = document.getElementById("filterInput").value;
      var xhr = new XMLHttpRequest();

      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
          var response = JSON.parse(xhr.responseText);
          var filteredResults = filterResults(response.items, filterInput);
          displayResults(filteredResults);
          updateSiteVisitsCount(); // Increment site visits count on search
        }
      };

      xhr.open("GET", "https://api.github.com/search/repositories?q=" + searchInput, true);
      xhr.send();
    });

    function filterResults(repositories, filterInput) {
      if (filterInput === "user") {
        return repositories.sort(function(a, b) {
          return a.owner.login.localeCompare(b.owner.login);
        });
      } else if (filterInput === "recent") {
        return repositories.sort(function(a, b) {
          var dateA = new Date(a.updated_at);
          var dateB = new Date(b.updated_at);
          return dateB - dateA;
        });
      } else if (filterInput === "stars") {
        return repositories.sort(function(a, b) {
          return b.stargazers_count - a.stargazers_count;
        });
      } else if (filterInput === "downloads") {
        return repositories.sort(function(a, b) {
          return b.downloads_count - a.downloads_count;
        });
      } else {
        return repositories;
      }
    }

    function displayResults(repositories) {
      var repositoryList = document.getElementById("repositoryList");
      repositoryList.innerHTML = "";

      repositories.forEach(function(repository) {
        var listItem = document.createElement("li");
        listItem.className = "repository";

        var header = document.createElement("div");
        header.className = "repository-header";

        var repoLink = document.createElement("a");
        repoLink.href = repository.html_url;
        repoLink.textContent = repository.full_name;

        var description = document.createElement("p");
        description.textContent = repository.description;

        var arrowIcon = document.createElement("span");
        arrowIcon.className = "arrow-icon";

        header.appendChild(repoLink);
        header.appendChild(description);
        header.appendChild(arrowIcon);

        var readmeContent = document.createElement("div");
        readmeContent.className = "readme-content";

        listItem.appendChild(header);
        listItem.appendChild(readmeContent);

        listItem.addEventListener("click", function() {
          toggleReadmeContent(readmeContent, repository.owner.login, repository.name);
          updateViewedRepos(repository.full_name); // Update viewed repositories
        });

        repositoryList.appendChild(listItem);
      });
    }

    function toggleReadmeContent(contentElement, owner, repo) {
      if (contentElement.classList.contains("expanded")) {
        contentElement.innerHTML = "";
        contentElement.classList.remove("expanded");
      } else {
        contentElement.innerHTML = "<em>Loading README...</em>";

        // Fetch the README content
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
            if (xhr.status === 200) {
              contentElement.innerHTML = xhr.responseText;
            } else {
              contentElement.innerHTML = "<em>Failed to load README.</em>";
            }
          }
        };

        xhr.open("GET", `https://api.github.com/repos/${owner}/${repo}/readme`, true);
        xhr.setRequestHeader("Accept", "application/vnd.github.VERSION.html");
        xhr.send();

        contentElement.classList.add("expanded");
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      var modal = document.getElementById("readmeModal");
      var closeModal = document.getElementsByClassName("close")[0];

      closeModal.addEventListener("click", function() {
        modal.style.display = "none";
      });

      window.addEventListener("click", function(event) {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      });
    });
  </script>
</body>
</html>
